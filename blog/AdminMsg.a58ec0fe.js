function e(e){return e&&e.__esModule?e.default:e}function t(e,t,a,s){Object.defineProperty(e,t,{get:a,set:s,enumerable:!0,configurable:!0})}var a=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire35b1;a.register("5uSfZ",function(s,n){Object.defineProperty(s.exports,"__esModule",{value:!0,configurable:!0}),t(s.exports,"default",function(){return u});var l=a("aOJwI"),i=a("b1abw"),r=a("e0rqH"),c=a("4PLf1"),m=a("stS02"),o=a("g5eIn"),g=a("7gcRj"),d=a("3Qkmj"),u=()=>{let{$:t,Fetch:a,getReducer:s,rwdStatus:n,changeWebTitle:u}=(0,r.useContext)(m.NewContext),N=(0,c.useNavigate)(),{authInfo:E}=s(e=>(0,l._)({},e.AdminLoginReducer)),[{msgData:v,renderMsgData:p,toggleModalStatus:f,toggleDeleteModalStatus:h,currentAction:D,valGroups:b,useDisabled:C,paginationObj:k},P]=(0,r.useState)({msgData:[],renderMsgData:[],toggleModalStatus:!1,toggleDeleteModalStatus:!1,valGroups:{mud:"",articleID:"",msgNickName:"",msgContent:"",resContentList:[],createDate:""},currentAction:"",useDisabled:!1,paginationObj:{}}),[y,L]=(0,r.useState)(!1),_={hasPrev:k.hasPrev,hasNext:k.hasNext,currentPage:k.currentPage,pageTotal:k.pageTotal,pageSize:k.pageSize,partPage:k.partPage,postNext:e=>{let{pages:t,partPage:a,pageSize:s}=e,{pageObj:n,renderItem:r}=(0,o.default).createParts(v,t,a,s);P(e=>(0,i._)((0,l._)({},e),{renderMsgData:r,paginationObj:n}))}},M=e=>{let[t]=e.split(" ");return t},T=async()=>{L(!0),await a.get("/back_view_all",{token:E.token}).then(({data:e})=>{a.get("/back_msg_l_all",{token:E.token}).then(a=>{let s=t.maps(a.data,a=>{let s=t.filter(e,({uuid:e})=>e===a.articleID);return s.length>0?(0,i._)((0,l._)({},a),{articleTitle:s[0].articleTitle}):a}),{pageObj:n,renderItem:r}=(0,o.default).createParts(s,1,10,10);P(e=>(0,i._)((0,l._)({},e),{msgData:s,renderMsgData:r,paginationObj:n})),L(!1)}).catch(()=>alert("error"))}).catch(()=>alert("error"))},I=(e,t)=>{"DELETE"===e?P(a=>(0,i._)((0,l._)({},a),{currentAction:e,valGroups:t,toggleDeleteModalStatus:!0})):P(a=>(0,i._)((0,l._)({},a),{currentAction:e,valGroups:t,toggleModalStatus:!0,useDisabled:"READ"===e}))},S=e=>{let a=JSON.parse(JSON.stringify(b)),s=t.findIndexOfObj(a.resContentList,({resMsgID:t})=>t===e);a.resContentList=a.resContentList.remove(s),P(e=>(0,i._)((0,l._)({},e),{valGroups:a}))},x=(e,s)=>{let n=!1,r={[e]:async()=>{if("confirm"===s&&"READ"!==e){let e=t.formatDateTime({formatDate:new Date,formatType:"yyyy-MM-dd HH:mm:ss"}),s=JSON.parse(JSON.stringify(b));s.modifyDate=e,L(!0),await a.post("/update_msg_l",{token:E.token,data:s}),n=!0,L(!1)}},DELETE:async()=>{if("confirm"===s){let{mud:e}=b;L(!0),await a.post("/delete_msg_l",{token:E.token,data:{mud:e}}),T(),n=!0,L(!1)}}}[e];r().finally(()=>{P(e=>(0,i._)((0,l._)({},e),{toggleModalStatus:!1,toggleDeleteModalStatus:!1,valGroups:{mud:"",articleID:"",msgNickName:"",msgContent:"",resContentList:[],createDate:""},useDisabled:!1})),n&&T()})};return(0,r.useEffect)(()=>{(null==E?void 0:E.token)?T():N({pathname:"/admin/login"})},[E]),/*@__PURE__*/e(r).createElement(d.Container,null,u("後台留言管理"),/*@__PURE__*/e(r).createElement("div",{className:"msg-layout"},n?null:/*@__PURE__*/e(r).createElement("div",{className:"msg-list-header"},["留言者","留言內容","留言文章","留言 / 修改日期","操作項"].map((t,a)=>/*@__PURE__*/e(r).createElement("div",{key:a},t))),/*@__PURE__*/e(r).createElement("div",{className:"msg-list"},0===p.length?/*@__PURE__*/e(r).createElement("div",{className:"no-data"},"-- 無留言 --"):p.map((t,a)=>n?/*@__PURE__*/e(r).createElement("div",{key:a,className:"msg-list-item"},/*@__PURE__*/e(r).createElement("div",{className:"top"},/*@__PURE__*/e(r).createElement("div",{className:"left"},/*@__PURE__*/e(r).createElement("div",null,"留言者"),/*@__PURE__*/e(r).createElement("div",null,"留言內容"),/*@__PURE__*/e(r).createElement("div",null,"留言文章"),/*@__PURE__*/e(r).createElement("div",null,"留言 / 修改日期")),/*@__PURE__*/e(r).createElement("div",{className:"right"},/*@__PURE__*/e(r).createElement("div",null,t.msgNickName),/*@__PURE__*/e(r).createElement("div",null,t.msgContent),/*@__PURE__*/e(r).createElement("div",null,t.articleTitle),/*@__PURE__*/e(r).createElement("div",null,M(t.createDate)," / ",M(t.modifyDate)))),/*@__PURE__*/e(r).createElement("div",{className:"bottom"},/*@__PURE__*/e(r).createElement("div",{className:"btn-group"},/*@__PURE__*/e(r).createElement("div",{onClick:I.bind(void 0,"READ",{mud:"",msgNickName:t.msgNickName,msgContent:t.msgContent,articleID:"",resContentList:t.resContentList,createDate:""}),className:"preview"},/*@__PURE__*/e(r).createElement("i",{className:"fas fa-eye"})),/*@__PURE__*/e(r).createElement("div",{onClick:I.bind(void 0,"EDIT",{mud:t.uuid,msgNickName:t.msgNickName,msgContent:t.msgContent,articleID:t.articleID,resContentList:t.resContentList,createDate:t.createDate}),className:"edit-btn"},/*@__PURE__*/e(r).createElement("i",{className:"fas fa-pencil"})),/*@__PURE__*/e(r).createElement("div",{onClick:I.bind(void 0,"DELETE",{mud:t.uuid,msgNickName:t.msgNickName,msgContent:"",articleID:"",resContentList:[],createDate:""}),className:"delete-btn"},/*@__PURE__*/e(r).createElement("i",{className:"fas fa-trash-alt"}))))):/*@__PURE__*/e(r).createElement("div",{key:a,className:"msg-list-item"},/*@__PURE__*/e(r).createElement("div",null,t.msgNickName),/*@__PURE__*/e(r).createElement("div",null,t.msgContent),/*@__PURE__*/e(r).createElement("div",null,t.articleTitle),/*@__PURE__*/e(r).createElement("div",null,M(t.createDate)," / ",M(t.modifyDate)),/*@__PURE__*/e(r).createElement("div",{className:"btn-group"},/*@__PURE__*/e(r).createElement("div",{onClick:I.bind(void 0,"READ",{mud:"",msgNickName:t.msgNickName,msgContent:t.msgContent,articleID:"",resContentList:t.resContentList,createDate:""}),className:"preview"},/*@__PURE__*/e(r).createElement("i",{className:"fas fa-eye"})),/*@__PURE__*/e(r).createElement("div",{onClick:I.bind(void 0,"EDIT",{mud:t.uuid,msgNickName:t.msgNickName,msgContent:t.msgContent,articleID:t.articleID,resContentList:t.resContentList,createDate:t.createDate}),className:"edit-btn"},/*@__PURE__*/e(r).createElement("i",{className:"fas fa-pencil"})),/*@__PURE__*/e(r).createElement("div",{onClick:I.bind(void 0,"DELETE",{mud:t.uuid,msgNickName:t.msgNickName,msgContent:"",articleID:"",resContentList:[],createDate:""}),className:"delete-btn"},/*@__PURE__*/e(r).createElement("i",{className:"fas fa-trash-alt"})))))),/*@__PURE__*/e(r).createElement("div",{className:"msg-list-footer"},"總留言數 ",v.length," 則"),/*@__PURE__*/e(r).createElement(g.Pagination,_)),/*@__PURE__*/e(r).createElement(g.ActionModal,{acionModalTitle:`${{DELETE:"刪除",READ:"檢視",EDIT:"編輯"}[D]}留言`,toggleModalStatus:f,confirmEvent:x.bind(void 0,D,"confirm"),cancelEvent:C?void 0:x.bind(void 0,D,"cancel")},/*@__PURE__*/e(r).createElement("div",{className:"top"},/*@__PURE__*/e(r).createElement(g.CustomInput,{label:"留言者",bindVal:b.msgNickName,type:"text",disabled:!0,className:b.msgNickName?"lock":""}),/*@__PURE__*/e(r).createElement("div",{className:"text-area-outer"},/*@__PURE__*/e(r).createElement(g.CustomTextArea,{label:"留言內容",bindVal:b.msgContent,type:"text",disabled:!0,className:b.msgContent?"lock":""}))),/*@__PURE__*/e(r).createElement("div",{className:"bottom"},/*@__PURE__*/e(r).createElement("div",{className:"title"},"回覆留言"),/*@__PURE__*/e(r).createElement("div",{className:"res-msg-list-outer"},b.resContentList.length>0?/*@__PURE__*/e(r).createElement("div",{className:"res-msg-list"},b.resContentList.map((t,a)=>/*@__PURE__*/e(r).createElement("div",{key:a,className:"res-msg-list-item-outer"},/*@__PURE__*/e(r).createElement("div",{className:"row g-0"},/*@__PURE__*/e(r).createElement("div",{className:C?"col-sm-12":"col-sm-11"},/*@__PURE__*/e(r).createElement("div",{className:"res-msg-list-item"},/*@__PURE__*/e(r).createElement("div",{className:"res-msg-title"}," ",/*@__PURE__*/e(r).createElement("div",null,t.resMsgNickName),/*@__PURE__*/e(r).createElement("div",{className:"right-group"},/*@__PURE__*/e(r).createElement("div",null,M(t.createDate)))),/*@__PURE__*/e(r).createElement("div",null,t.resMsgContent))),C?null:/*@__PURE__*/e(r).createElement("div",{className:"col-sm-1"},/*@__PURE__*/e(r).createElement("div",{onClick:S.bind(void 0,t.resMsgID),className:"delete-msg-btn"},/*@__PURE__*/e(r).createElement("i",{className:"fas fa-trash-alt"}))))))):/*@__PURE__*/e(r).createElement("div",{className:"no-data"},"-- 無回覆內容 --")))),/*@__PURE__*/e(r).createElement(g.ActionModal,{toggleModalStatus:h,confirmEvent:x.bind(void 0,D,"confirm"),cancelEvent:x.bind(void 0,D,"cancel")},/*@__PURE__*/e(r).createElement("div",{className:"action-modal-body"},/*@__PURE__*/e(r).createElement("div",{className:"delete-context"},"確定要刪除 ",b.msgNickName," 此人的留言嗎？"))),/*@__PURE__*/e(r).createElement(g.Loading,{loadingStatus:y}))}}),a.register("g5eIn",function(e,a){t(e.exports,"default",function(){return n});class s{static createParts(...e){let[t,a,s,n]=e;this.setting.totalLength=t.length,this.setting.partPage=s,this.setting.pageTotal=Math.ceil(this.setting.totalLength/this.setting.partPage),this.setting.pageSize=n,a=void 0===a?1:a,this.setting.currentPage=a,this.setting.hasPrev=this.setting.currentPage>1,this.setting.hasNext=this.setting.currentPage<this.setting.totalLength,this.setting.currentPage===this.setting.pageTotal&&(this.setting.hasNext=!1),this.setting.currentPage>this.setting.pageTotal&&(this.setting.currentPage=this.setting.pageTotal);let l=this.setting.currentPage*this.setting.partPage-this.setting.partPage+1,i=this.setting.currentPage*this.setting.partPage,r=t.map((e,t)=>t+1>=l&&t+1<=i&&e).filter(e=>!1!==e);return{pageObj:this.setting,renderItem:r}}}s.setting={totalLength:0,partPage:0,pageTotal:0,currentPage:1,hasPrev:!1,hasNext:!0,pageSize:0};var n=s});